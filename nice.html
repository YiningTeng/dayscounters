<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Nice? - A website to analyze products based on user information.">
    <meta name="keywords" content="Nice, product analysis, AI, Gemini, Google AI">
    <meta name="author" content="Your Name">
    <title>Nice?</title>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 21px;
            background-color: #f4f4f9;
            color: #333;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        h1 {
            font-family: 'Pacifico', cursive;
            font-size: 3rem;
            color: #ff6f61;
            text-align: center;
            margin-bottom: 20px;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            flex: 1;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        input, select {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
        }
        button {
            width: 100%;
            padding: 12px;
            background-color: #ff6f61;
            color: #fff;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
        }
        button:hover {
            background-color: #ff4a3d;
        }
        .language-select {
            margin-bottom: 20px;
        }
        .language-select select {
            width: auto;
            padding: 5px;
        }
        .unit-toggle {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .unit-toggle label {
            margin-right: 10px;
        }
        .unit-toggle select {
            width: auto;
            padding: 5px;
        }
        .photo-section {
            margin-top: 20px;
        }
        .photo-section button {
            margin-bottom: 10px;
        }
        .result {
            margin-top: 20px;
            padding: 10px;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .loading {
            display: none;
            text-align: center;
            margin-top: 20px;
        }
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #ff6f61;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        footer {
            text-align: center;
            margin-top: 20px;
            padding: 10px;
            font-size: 0.9rem;
            color: #666;
        }
        .debug {
            margin-top: 20px;
            padding: 10px;
            background-color: #f1f1f1;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 id="title">Nice?</h1>
        <div class="language-select">
            <label for="language" id="languageLabel">Select Language:</label>
            <select id="language">
                <option value="en" data-flag="ðŸ‡ºðŸ‡¸">English</option>
                <option value="zh" data-flag="ðŸ‡¨ðŸ‡³">ä¸­æ–‡ (Chinese)</option>
                <option value="ja" data-flag="ðŸ‡¯ðŸ‡µ">æ—¥æœ¬èªž (Japanese)</option>
                <option value="ko" data-flag="ðŸ‡°ðŸ‡·">í•œêµ­ì–´ (Korean)</option>
                <option value="es" data-flag="ðŸ‡ªðŸ‡¸">EspaÃ±ol (Spanish)</option>
                <option value="fr" data-flag="ðŸ‡«ðŸ‡·">FranÃ§ais (French)</option>
                <option value="de" data-flag="ðŸ‡©ðŸ‡ª">Deutsch (German)</option>
            </select>
        </div>
        <label for="age" id="ageLabel">Age (optional):</label>
        <input type="number" id="age" min="0">
        <div class="unit-toggle">
            <label for="heightUnit" id="heightUnitLabel">Height Unit:</label>
            <select id="heightUnit">
                <option value="cm">cm</option>
                <option value="ft">ft</option>
            </select>
        </div>
        <label for="height" id="heightLabel">Height (optional):</label>
        <input type="number" id="height" min="0" placeholder="in cm">
        <div class="unit-toggle">
            <label for="weightUnit" id="weightUnitLabel">Weight Unit:</label>
            <select id="weightUnit">
                <option value="kg">kg</option>
                <option value="lb">lb</option>
            </select>
        </div>
        <label for="weight" id="weightLabel">Weight (optional):</label>
        <input type="number" id="weight" min="0" placeholder="in kg">
        <label for="sex" id="sexLabel">Sex (optional):</label>
        <select id="sex">
            <option value="">Select</option>
            <option value="male">Male</option>
            <option value="female">Female</option>
            <option value="other">Other</option>
        </select>
        <label for="nationality" id="nationalityLabel">Nationality (optional):</label>
        <input type="text" id="nationality">
        <button onclick="updateURL()" id="confirmButton">Confirm</button>

        <!-- Photo Section -->
        <div class="photo-section">
            <label id="photoLabel">Upload or Take a Photo:</label>
            <input type="file" id="photoInput" accept="image/*" capture="environment" style="display: none;">
            <button onclick="document.getElementById('photoInput').click()" id="photoButton">Choose Photo</button>
        </div>

        <!-- Loading Section -->
        <div class="loading" id="loading">
            <div class="loading-spinner"></div>
            <p>Analyzing photo, please wait...</p>
        </div>

        <!-- Result Section -->
        <div class="result" id="result"></div>

        <!-- Debug Section -->
        <div class="debug">
            <p>Debug Information:</p>
            <p>API Key: <span id="apiKey"></span></p>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        &copy; 2023 Nice? All rights reserved.
    </footer>

    <script>
        // Language translations
        const translations = {
            en: {
                title: "Nice?",
                languageLabel: "Select Language:",
                ageLabel: "Age (optional):",
                heightLabel: "Height (optional):",
                heightUnitLabel: "Height Unit:",
                weightLabel: "Weight (optional):",
                weightUnitLabel: "Weight Unit:",
                sexLabel: "Sex (optional):",
                nationalityLabel: "Nationality (optional):",
                confirmButton: "Confirm",
                photoLabel: "Upload or Take a Photo:",
                photoButton: "Choose Photo",
                loadingText: "Analyzing photo, please wait..."
            },
            zh: {
                title: "ä¸é”™ï¼Ÿ",
                languageLabel: "é€‰æ‹©è¯­è¨€ï¼š",
                ageLabel: "å¹´é¾„ï¼ˆå¯é€‰ï¼‰ï¼š",
                heightLabel: "èº«é«˜ï¼ˆå¯é€‰ï¼‰ï¼š",
                heightUnitLabel: "èº«é«˜å•ä½ï¼š",
                weightLabel: "ä½“é‡ï¼ˆå¯é€‰ï¼‰ï¼š",
                weightUnitLabel: "ä½“é‡å•ä½ï¼š",
                sexLabel: "æ€§åˆ«ï¼ˆå¯é€‰ï¼‰ï¼š",
                nationalityLabel: "æ°‘æ—ï¼ˆå¯é€‰ï¼‰ï¼š",
                confirmButton: "ç¡®è®¤",
                photoLabel: "ä¸Šä¼ æˆ–æ‹æ‘„ç…§ç‰‡ï¼š",
                photoButton: "é€‰æ‹©ç…§ç‰‡",
                loadingText: "æ­£åœ¨åˆ†æžç…§ç‰‡ï¼Œè¯·ç¨å€™..."
            },
            ja: {
                title: "ã„ã„ã§ã™ã‹ï¼Ÿ",
                languageLabel: "è¨€èªžã‚’é¸æŠžï¼š",
                ageLabel: "å¹´é½¢ï¼ˆä»»æ„ï¼‰ï¼š",
                heightLabel: "èº«é•·ï¼ˆä»»æ„ï¼‰ï¼š",
                heightUnitLabel: "èº«é•·å˜ä½ï¼š",
                weightLabel: "ä½“é‡ï¼ˆä»»æ„ï¼‰ï¼š",
                weightUnitLabel: "ä½“é‡å˜ä½ï¼š",
                sexLabel: "æ€§åˆ¥ï¼ˆä»»æ„ï¼‰ï¼š",
                nationalityLabel: "å›½ç±ï¼ˆä»»æ„ï¼‰ï¼š",
                confirmButton: "ç¢ºèª",
                photoLabel: "å†™çœŸã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã¾ãŸã¯æ’®å½±ï¼š",
                photoButton: "å†™çœŸã‚’é¸æŠž",
                loadingText: "å†™çœŸã‚’åˆ†æžä¸­ã€ãŠå¾…ã¡ãã ã•ã„..."
            },
            ko: {
                title: "ì¢‹ì•„ìš”?",
                languageLabel: "ì–¸ì–´ ì„ íƒ:",
                ageLabel: "ë‚˜ì´ (ì„ íƒ ì‚¬í•­):",
                heightLabel: "í‚¤ (ì„ íƒ ì‚¬í•­):",
                heightUnitLabel: "í‚¤ ë‹¨ìœ„:",
                weightLabel: "ì²´ì¤‘ (ì„ íƒ ì‚¬í•­):",
                weightUnitLabel: "ì²´ì¤‘ ë‹¨ìœ„:",
                sexLabel: "ì„±ë³„ (ì„ íƒ ì‚¬í•­):",
                nationalityLabel: "êµ­ì  (ì„ íƒ ì‚¬í•­):",
                confirmButton: "í™•ì¸",
                photoLabel: "ì‚¬ì§„ ì—…ë¡œë“œ ë˜ëŠ” ì´¬ì˜:",
                photoButton: "ì‚¬ì§„ ì„ íƒ",
                loadingText: "ì‚¬ì§„ì„ ë¶„ì„ ì¤‘ìž…ë‹ˆë‹¤. ìž ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”..."
            },
            es: {
                title: "Â¿Bien?",
                languageLabel: "Seleccionar idioma:",
                ageLabel: "Edad (opcional):",
                heightLabel: "Altura (opcional):",
                heightUnitLabel: "Unidad de altura:",
                weightLabel: "Peso (opcional):",
                weightUnitLabel: "Unidad de peso:",
                sexLabel: "Sexo (opcional):",
                nationalityLabel: "Nacionalidad (opcional):",
                confirmButton: "Confirmar",
                photoLabel: "Subir o tomar una foto:",
                photoButton: "Elegir foto",
                loadingText: "Analizando la foto, por favor espere..."
            },
            fr: {
                title: "Sympa ?",
                languageLabel: "Choisir la langue :",
                ageLabel: "Ã‚ge (facultatif) :",
                heightLabel: "Taille (facultatif) :",
                heightUnitLabel: "UnitÃ© de taille :",
                weightLabel: "Poids (facultatif) :",
                weightUnitLabel: "UnitÃ© de poids :",
                sexLabel: "Sexe (facultatif) :",
                nationalityLabel: "NationalitÃ© (facultatif) :",
                confirmButton: "Confirmer",
                photoLabel: "TÃ©lÃ©charger ou prendre une photo :",
                photoButton: "Choisir une photo",
                loadingText: "Analyse de la foto en cours, veuillez patienter..."
            },
            de: {
                title: "SchÃ¶n?",
                languageLabel: "Sprache auswÃ¤hlen:",
                ageLabel: "Alter (optional):",
                heightLabel: "GrÃ¶ÃŸe (optional):",
                heightUnitLabel: "GrÃ¶ÃŸeneinheit:",
                weightLabel: "Gewicht (optional):",
                weightUnitLabel: "Gewichtseinheit:",
                sexLabel: "Geschlecht (optional):",
                nationalityLabel: "NationalitÃ¤t (optional):",
                confirmButton: "BestÃ¤tigen",
                photoLabel: "Foto hochladen oder aufnehmen:",
                photoButton: "Foto auswÃ¤hlen",
                loadingText: "Foto wird analysiert, bitte warten..."
            }
        };

        // Function to update the page language
        function updateLanguage(lang) {
            const translation = translations[lang];
            document.getElementById('title').textContent = translation.title;
            document.getElementById('languageLabel').textContent = translation.languageLabel;
            document.getElementById('ageLabel').textContent = translation.ageLabel;
            document.getElementById('heightLabel').textContent = translation.heightLabel;
            document.getElementById('heightUnitLabel').textContent = translation.heightUnitLabel;
            document.getElementById('weightLabel').textContent = translation.weightLabel;
            document.getElementById('weightUnitLabel').textContent = translation.weightUnitLabel;
            document.getElementById('sexLabel').textContent = translation.sexLabel;
            document.getElementById('nationalityLabel').textContent = translation.nationalityLabel;
            document.getElementById('confirmButton').textContent = translation.confirmButton;
            document.getElementById('photoLabel').textContent = translation.photoLabel;
            document.getElementById('photoButton').textContent = translation.photoButton;
            document.getElementById('loading').querySelector('p').textContent = translation.loadingText;

            // Update placeholders based on selected units
            const heightUnit = document.getElementById('heightUnit').value;
            const weightUnit = document.getElementById('weightUnit').value;
            document.getElementById('height').placeholder = `in ${heightUnit}`;
            document.getElementById('weight').placeholder = `in ${weightUnit}`;
        }

        // Function to handle language change
        document.getElementById('language').addEventListener('change', function () {
            const lang = this.value;
            localStorage.setItem('selectedLanguage', lang); // Save language to localStorage
            updateLanguage(lang);
        });

        // Function to handle height unit change
        document.getElementById('heightUnit').addEventListener('change', function () {
            const heightUnit = this.value;
            document.getElementById('height').placeholder = `in ${heightUnit}`;
        });

        // Function to handle weight unit change
        document.getElementById('weightUnit').addEventListener('change', function () {
            const weightUnit = this.value;
            document.getElementById('weight').placeholder = `in ${weightUnit}`;
        });

        // Function to update the URL with user inputs
        function updateURL() {
            const age = document.getElementById('age').value;
            const height = document.getElementById('height').value;
            const heightUnit = document.getElementById('heightUnit').value;
            const weight = document.getElementById('weight').value;
            const weightUnit = document.getElementById('weightUnit').value;
            const sex = document.getElementById('sex').value;
            const nationality = document.getElementById('nationality').value;

            const params = new URLSearchParams();
            if (age) params.set('age', age);
            if (height) params.set('height', `${height}${heightUnit}`);
            if (weight) params.set('weight', `${weight}${weightUnit}`);
            if (sex) params.set('sex', sex);
            if (nationality) params.set('nationality', nationality);

            const newURL = `${window.location.origin}${window.location.pathname}?${params.toString()}`;
            window.history.pushState({}, '', newURL);
        }

        // Function to populate fields from URL parameters
        function populateFieldsFromURL() {
            const params = new URLSearchParams(window.location.search);
            document.getElementById('age').value = params.get('age') || '';
            const heightValue = params.get('height') || '';
            if (heightValue) {
                const heightUnit = heightValue.includes('ft') ? 'ft' : 'cm';
                const height = heightValue.replace(/[^0-9.]/g, '');
                document.getElementById('height').value = height;
                document.getElementById('heightUnit').value = heightUnit;
            }
            const weightValue = params.get('weight') || '';
            if (weightValue) {
                const weightUnit = weightValue.includes('lb') ? 'lb' : 'kg';
                const weight = weightValue.replace(/[^0-9.]/g, '');
                document.getElementById('weight').value = weight;
                document.getElementById('weightUnit').value = weightUnit;
            }
            document.getElementById('sex').value = params.get('sex') || '';
            document.getElementById('nationality').value = params.get('nationality') || '';
        }

        // Function to analyze the photo using Google Gemini 1.5 Pro
        async function analyzePhoto(file) {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = async () => {
                const base64Image = reader.result.split(',')[1];

                const age = document.getElementById('age').value;
                const height = document.getElementById('height').value;
                const heightUnit = document.getElementById('heightUnit').value;
                const weight = document.getElementById('weight').value;
                const weightUnit = document.getElementById('weightUnit').value;
                const sex = document.getElementById('sex').value;
                const nationality = document.getElementById('nationality').value;
                const language = document.getElementById('language').value;

                const prompt = `Analyze the product in this image. Provide a brief description, market evaluation, whether it is a high-quality product, and recommendations based on the following user information: Age: ${age}, Height: ${height}${heightUnit}, Weight: ${weight}${weightUnit}, Sex: ${sex}, Nationality: ${nationality}. Respond in ${language}. Use Markdown formatting for the response.`;

                const requestBody = {
                    contents: [
                        {
                            parts: [
                                { text: prompt },
                                {
                                    inline_data: {
                                        mime_type: file.type,
                                        data: base64Image
                                    }
                                }
                            ]
                        }
                    ]
                };

                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-pro:generateContent?key=${window.apiKey}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(requestBody)
                    });
                    const result = await response.json();
                    const analysisResult = result.candidates[0].content.parts[0].text;
                    document.getElementById('result').innerHTML = marked.parse(analysisResult); // Render Markdown
                } catch (error) {
                    console.error("Error analyzing photo:", error);
                    document.getElementById('result').innerHTML = "Failed to analyze the photo. Please try again.";
                } finally {
                    document.getElementById('loading').style.display = 'none'; // Hide loading spinner
                }
            };
        }

        // Handle photo input change
        document.getElementById('photoInput').addEventListener('change', function (event) {
            const file = event.target.files[0];
            if (file) {
                document.getElementById('loading').style.display = 'block'; // Show loading spinner
                analyzePhoto(file);
            }
        });

        // Initialize the page
        function initializePage() {
            const savedLanguage = localStorage.getItem('selectedLanguage') || 'en';
            document.getElementById('language').value = savedLanguage;
            updateLanguage(savedLanguage);
            populateFieldsFromURL();

            // Set API Key from environment variable
            window.apiKey = '';
            document.getElementById('apiKey').textContent = window.apiKey; // Display API Key for debugging
        }

        // Run initialization when the page loads
        window.onload = initializePage;
    </script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script> <!-- Markdown rendering library -->
</body>
</html>
